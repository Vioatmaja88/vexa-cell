<!-- Voucher Card Template -->
<!-- 
<div class="voucher-card" data-code="{{voucher_code}}" data-price="{{price}}">
  <div class="voucher-icon">
    {{icon_or_logo}}
  </div>
  <div class="voucher-name">{{name}}</div>
  <div class="voucher-meta">{{provider}} • {{nominal}}</div>
  <div class="voucher-price">{{price_formatted}}</div>
  <button class="voucher-btn" onclick="Checkout.quickBuy('{{voucher_code}}')">
    Beli
  </button>
</div>
-->

<script>
// Voucher Card Component Script
const VoucherCard = {
  create(voucher) {
    const card = document.createElement('div');
    card.className = 'voucher-card';
    card.dataset.code = voucher.voucher_code;
    card.dataset.price = voucher.price_sell;

    const icon = voucher.providers?.logo_url 
      ? `<img src="${voucher.providers.logo_url}" alt="${voucher.providers.provider_name}" class="w-7 h-7 object-contain">`
      : `<i data-lucide="${VoucherCard.getIconForCategory(voucher.category)}" class="w-6 h-6"></i>`;

    card.innerHTML = `
      <div class="voucher-icon">
        ${icon}
      </div>
      <div class="voucher-name">${voucher.name}</div>
      <div class="voucher-meta">
        ${voucher.providers?.provider_name || '-'} • ${voucher.nominal}
      </div>
      <div class="voucher-price">Rp${voucher.price_sell.toLocaleString('id-ID')}</div>
      <button class="voucher-btn" onclick="VoucherCard.handleClick('${voucher.voucher_code}')">
        Beli
      </button>
    `;

    // Add click handler for card (open detail)
    card.addEventListener('click', (e) => {
      if (!e.target.closest('button')) {
        VoucherCard.showDetail(voucher.voucher_code);
      }
    });

    return card;
  },

  getIconForCategory(category) {
    const icons = {
      'pulsa': 'smartphone',
      'data': 'wifi',
      'pln': 'zap',
      'ewallet': 'wallet',
      'game': 'gamepad-2',
      'ppob': 'credit-card'
    };
    return icons[category] || 'package';
  },

  handleClick(code) {
    window.location.href = `/checkout.html?voucher=${code}`;
  },

  async showDetail(code) {
    try {
      App.showLoading(true);
      const data = await App.request(`/vouchers/${code}`);
      const voucher = data.data.voucher;

      ModalComponent.show(`
        <div class="p-6">
          <div class="flex items-center space-x-4 mb-6">
            <div class="w-16 h-16 bg-gradient-to-br from-primary-100 to-primary-200 rounded-2xl flex items-center justify-center">
              ${voucher.providers?.logo_url 
                ? `<img src="${voucher.providers.logo_url}" class="w-10 h-10 object-contain">`
                : `<i data-lucide="${VoucherCard.getIconForCategory(voucher.category)}" class="w-8 h-8 text-primary-600"></i>`
              }
            </div>
            <div>
              <h3 class="font-bold text-lg text-navy-900">${voucher.name}</h3>
              <p class="text-sm text-gray-500">${voucher.providers?.provider_name} • ${voucher.nominal}</p>
            </div>
          </div>

          <div class="space-y-3 mb-6">
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Harga</span>
              <span class="font-semibold">Rp${voucher.price_sell.toLocaleString('id-ID')}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Provider</span>
              <span class="font-medium">${voucher.providers?.provider_name}</span>
            </div>
            <div class="flex justify-between text-sm">
              <span class="text-gray-600">Kategori</span>
              <span class="font-medium">${voucher.category.toUpperCase()}</span>
            </div>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-navy-700 mb-2">Nomor Tujuan</label>
            <input type="tel" id="modalTargetNumber" placeholder="0812xxxxxxxx" 
                   class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm"
                   pattern="[0-9]{10,15}">
          </div>

          <button onclick="VoucherCard.buyFromModal('${voucher.voucher_code}')" 
                  class="w-full py-3 bg-primary-600 hover:bg-primary-700 text-white rounded-xl font-medium btn-hover transition-all">
            Lanjutkan Pembayaran
          </button>
        </div>
      `);
    } catch (err) {
      Utils.showToast('error', 'Error', 'Gagal memuat detail voucher');
    } finally {
      App.showLoading(false);
    }
  },

  async buyFromModal(code) {
    const targetNumber = document.getElementById('modalTargetNumber')?.value?.trim();
    
    if (!targetNumber || !Utils.isValidPhone(targetNumber)) {
      Utils.showToast('warning', 'Validasi', 'Masukkan nomor tujuan yang valid');
      return;
    }

    ModalComponent.hide();
    window.location.href = `/checkout.html?voucher=${code}&target=${targetNumber}`;
  }
};

window.VoucherCard = VoucherCard;
</script>